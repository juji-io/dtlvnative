#!/bin/bash

rm macosx-arm64/resources/datalevin/dtlvnative/macosx-arm64/*

script/build-macos

cp src/*.dylib macosx-arm64/resources/datalevin/dtlvnative/macosx-arm64/

cd macosx-arm64
lein deps

cd ../src/java
java -jar ~/.m2/repository/org/bytedeco/javacpp/1.5.12/javacpp-1.5.12.jar datalevin/dtlvnative/DTLV.java

cd ../..
cp src/java/datalevin/dtlvnative/macosx-arm64/*.dylib macosx-arm64/resources/datalevin/dtlvnative/macosx-arm64/

cd macosx-arm64
lein run

lein jar
